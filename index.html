<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>Pixel Sword</title>
<style>
  body { margin: 0; overflow: hidden; background: #111; }
  canvas { display: block; margin: auto; background: #1a1a1a; }
</style>
</head>
<body>
<canvas id="game" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const WIDTH = canvas.width;
const HEIGHT = canvas.height;

const keys = {};
document.addEventListener('keydown', e => keys[e.code] = true);
document.addEventListener('keyup', e => keys[e.code] = false);

// === Гравець ===
const player = {
  x: 100, y: 300,
  vx: 0, vy: 0,
  width: 30, height: 50,
  color: '#00d0ff',
  onGround: false,
  hp: 5,
  attacking: false,
  attackTimer: 0
};

// === Вороги ===
let enemies = [
  {x: 500, y: 300, width: 30, height: 50, hp: 3, color: '#e74c3c'},
  {x: 650, y: 300, width: 30, height: 50, hp: 3, color: '#e67e22'}
];

// === Платформи ===
let platforms = [
  {x: 0, y: 350, width: 800, height: 50},
  {x: 300, y: 270, width: 100, height: 20},
  {x: 550, y: 200, width: 100, height: 20}
];

function rectsCollide(r1, r2) {
  return r1.x < r2.x + r2.width &&
         r1.x + r1.width > r2.x &&
         r1.y < r2.y + r2.height &&
         r1.y + r1.height > r2.y;
}

// === Управління ===
function handleInput() {
  player.vx = 0;
  if (keys['ArrowLeft'] || keys['KeyA']) player.vx = -3;
  if (keys['ArrowRight'] || keys['KeyD']) player.vx = 3;
  if ((keys['ArrowUp'] || keys['KeyW'] || keys['Space']) && player.onGround) {
    player.vy = -10;
    player.onGround = false;
  }
  if (keys['KeyJ'] && !player.attacking) {
    player.attacking = true;
    player.attackTimer = 10;
  }
}

// === Фізика ===
function updatePhysics() {
  player.vy += 0.5; // gravity
  player.x += player.vx;
  player.y += player.vy;

  player.onGround = false;
  for (let plat of platforms) {
    if (rectsCollide(player, plat)) {
      if (player.vy > 0) {
        player.y = plat.y - player.height;
        player.vy = 0;
        player.onGround = true;
      }
    }
  }

  // Межі
  if (player.y > HEIGHT) {
    player.y = 0;
    player.hp -= 1;
  }

  if (player.attacking) {
    player.attackTimer--;
    if (player.attackTimer <= 0) player.attacking = false;
  }

  // Атака по ворогах
  if (player.attacking) {
    for (let enemy of enemies) {
      const swordRange = {
        x: player.x + (player.vx >= 0 ? player.width : -20),
        y: player.y + 10,
        width: 20, height: 30
      };
      if (rectsCollide(swordRange, enemy)) {
        enemy.hp -= 1;
      }
    }
  }

  // Видалити мертвих ворогів
  enemies = enemies.filter(e => e.hp > 0);
}

// === Малювання ===
function draw() {
  ctx.clearRect(0, 0, WIDTH, HEIGHT);

  // Платформи
  ctx.fillStyle = '#333';
  for (let plat of platforms) {
    ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
  }

  // Гравець
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.width, player.height);

  // Меч (якщо атака)
  if (player.attacking) {
    ctx.fillStyle = '#ffff00';
    const swordX = player.x + (player.vx >= 0 ? player.width : -20);
    ctx.fillRect(swordX, player.y + 10, 20, 30);
  }

  // Вороги
  for (let enemy of enemies) {
    ctx.fillStyle = enemy.color;
    ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
  }

  // Життя
  ctx.fillStyle = 'white';
  ctx.font = '16px Arial';
  ctx.fillText('HP: ' + player.hp, 10, 20);
  if (player.hp <= 0) {
    ctx.fillStyle = 'rgba(0,0,0,0.8)';
    ctx.fillRect(0,0,WIDTH,HEIGHT);
    ctx.fillStyle = 'red';
    ctx.font = '40px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Game Over', WIDTH/2, HEIGHT/2);
  }
}

// === Цикл гри ===
function loop() {
  handleInput();
  updatePhysics();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>

