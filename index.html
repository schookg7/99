<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Geometry Dash Boss Edition</title>
  <style>
    body { margin: 0; background: #000; color: white; font-family: sans-serif; }
    canvas { display: block; margin: 0 auto; background: #111; }
    .menu { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; padding: 20px; }
    .btn {
      padding: 10px 20px;
      font-size: 18px;
      border: none;
      background: #333;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
    .btn:disabled { opacity: 0.3; cursor: not-allowed; }
  </style>
</head>
<body>

<h2 style="text-align:center;">Вибери рівень</h2>
<div class="menu" id="menu"></div>
<canvas id="game" width="800" height="400" style="display:none;"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let level = 0;
let playing = false;
let progress = parseInt(localStorage.getItem('gd-boss-progress')) || 1;

const player = {
  x: 50, y: 300, w: 30, h: 30,
  vy: 0, grounded: false,
  gravity: 0.9, jumpPower: -15
};

let obstacles = [];
let scrollX = 0;
let boss = null;
let speed = 3;

function makeLevel(index) {
  obstacles = [];
  speed = 3 + index * 0.3;
  const count = 5 + index * 2;
  for (let i = 0; i < count; i++) {
    const w = 20 + Math.random() * 40;
    const h = 30 + Math.random() * (index * 2 + 30);
    const x = 250 + i * 100;
    obstacles.push({x, y: 370 - h, w, h});
  }
  if (index === 49) createBoss();
}

function createBoss() {
  boss = {
    x: 900, y: 280, w: 60, h: 60, hp: 5,
    direction: 1
  };
}

function drawMenu() {
  const menu = document.getElementById('menu');
  menu.innerHTML = '';
  const max = 50;
  for (let i = 0; i < max; i++) {
    const btn = document.createElement('button');
    btn.textContent = i === 49 ? 'Босс (50)' : `Рівень ${i + 1}`;
    btn.className = 'btn';
    btn.disabled = i + 1 > progress;
    btn.onclick = () => startLevel(i);
    menu.appendChild(btn);
  }
}

function startLevel(i) {
  level = i;
  player.x = 50;
  player.y = 300;
  player.vy = 0;
  scrollX = 0;
  boss = null;
  canvas.style.display = 'block';
  document.getElementById('menu').style.display = 'none';
  makeLevel(i);
  playing = true;
  requestAnimationFrame(loop);
}

function jump() {
  if (player.grounded) {
    player.vy = player.jumpPower;
  }
}
canvas.addEventListener('mousedown', jump);
canvas.addEventListener('touchstart', jump);

function update() {
  scrollX += speed;
  player.vy += player.gravity;
  player.y += player.vy;
  if (player.y + player.h > 380) {
    player.y = 380 - player.h;
    player.vy = 0;
    player.grounded = true;
  } else {
    player.grounded = false;
  }

  // Перешкоди
  for (let o of obstacles) {
    const ox = o.x - scrollX;
    if (
      player.x < ox + o.w &&
      player.x + player.w > ox &&
      player.y < o.y + o.h &&
      player.y + player.h > o.y
    ) {
      gameOver();
      return;
    }
  }

  // Босс
  if (boss) {
    const bx = boss.x - scrollX;
    boss.y += boss.direction * 2;
    if (boss.y < 100 || boss.y > 320) boss.direction *= -1;
    if (
      player.x < bx + boss.w &&
      player.x + player.w > bx &&
      player.y < boss.y + boss.h &&
      player.y + player.h > boss.y
    ) {
      boss.hp -= 1;
      if (boss.hp <= 0) victory();
      else player.vy = -10;
    }
  }

  // Виграш
  if (!boss && scrollX > 1000 + level * 50) {
    victory();
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#444';
  ctx.fillRect(0, 380, 800, 20);

  // Перешкоди
  ctx.fillStyle = '#f55';
  for (let o of obstacles) {
    const x = o.x - scrollX;
    ctx.fillRect(x, o.y, o.w, o.h);
  }

  // Бос
  if (boss) {
    const bx = boss.x - scrollX;
    ctx.fillStyle = 'purple';
    ctx.fillRect(bx, boss.y, boss.w, boss.h);
    ctx.fillStyle = 'white';
    ctx.fillText(`HP: ${boss.hp}`, bx + 10, boss.y - 5);
  }

  // Гравець
  ctx.fillStyle = '#0cf';
  ctx.fillRect(player.x, player.y, player.w, player.h);
}

function loop() {
  if (!playing) return;
  update();
  draw();
  requestAnimationFrame(loop);
}

function gameOver() {
  playing = false;
  setTimeout(() => {
    canvas.style.display = 'none';
    drawMenu();
    document.getElementById('menu').style.display = 'flex';
  }, 800);
}

function victory() {
  playing = false;
  if (progress < level + 2) {
    progress = level + 2;
    localStorage.setItem('gd-boss-progress', progress);
  }
  setTimeout(() => {
    canvas.style.display = 'none';
    drawMenu();
    document.getElementById('menu').style.display = 'flex';
  }, 800);
}

drawMenu();
</script>

</body>
</html>
